<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://xmlns.jcp.org/xml/ns/javaee" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd" id="WebApp_ID" version="3.1">
  <display-name>shop</display-name>
  
  	
  	<!-- 
  		서버가 가동될때를 감지하는 리스너 등록
  		ServletContext에 대한 초기설정을 위해서는 서버가 가동되는 시점에 동작하는 리스너를 이용해야 함 
  	 -->
	<context-param>
			<param-name>contextClass</param-name>
			<param-value>org.springframework.web.context.support.AnnotationConfigWebApplicationContext</param-value>
	</context-param>
	
	<context-param>
		<param-name>contextConfigLocation</param-name>
		<param-value>com.ch.shop.config.spring.RootConfig</param-value>	
	</context-param>  	 
	
	<!-- 
		애플리케이션이 가동되는 시점에 ServletContext 를 얻어와, AnnotaionConfigApplicationContext 컨테이너에 
		설정파일을 이용하여 빈들을 생성하게 하려고...
	 -->
  	<listener>
  		<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
  	</listener>
  
  	<!--  
  	
  		MVC에서 모델영역은 모든 요청 서블릿들 간 공유가 되어야 하는 공통기능이므로, 특정 서블릿의 수준으로
  		등록하면 안된다..이유) 예-관리자용 서블릿에 등록해버리면, 쇼핑몰 유저가 톰켓 가동과 동시에 먼저 접근
  		하게 될 경우 모델 객체들이 아직 인스턴스 생성 이전 시점으므로, 모델객체들을 사용할수없 게된다..
  		
  		해결책? 특정 서블릿에 소속되게 하지말고, 생명력을 훨씬더 끌어올려서 스프링빈 컨테이너를 관리하게 하자
  				  즉 생명력이 길고 ,서버를 가동하는 시점부터 태어나는 객체를 이용하면 된다..
  				   javaee에서 서버가동과 동시에 생성되어, 서버 종료시까지 생명력을 유지하는 객체인 
  				   즉 애플리케이션의 전역 정보를 가진 객체인 ServletContext에게 맡기면 된다 
  					참고) ServletContext 의 JSP 의 내장객체명은? application 
  	-->
	<filter>
		<filter-name>encodingFilter</filter-name>
		<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
		<init-param>
			<param-name>encoding</param-name>
			<param-value>UTF-8</param-value>
		</init-param>
	</filter>
	<filter-mapping>
		<filter-name>encodingFilter</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
	  
	<!--
	우리가 제작한 MVC프레임워크와 마찬가지로, 스프링MVC 또한 모든 요청을 하나의 진입점으로 몰아넣는다
	즉 프론트(맨 앞)에 유일한 컨트롤러 하나를 둔다
	-->
	<servlet>
		<servlet-name>admin-dispatcher</servlet-name>
		<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
		
		<!-- init-param 이란? 	이 서블릿의 인스턴스가 최초에 생성되어질때, 호출되는 생명주기 메서드인 init() 메서드 안으로
										전달할 문자열 정보가 있을 경우 이 파라미터 태그를 이용할 수 있다.
										아래의 경우 전통적으로 사용해왔던 , xml 방식이 아닌 자바 클래스를 이용한 설정방식을 위한 클래스의 위치를
										지정하고 있다..
										주의) 자바 설정 방식을 사용할 경우 스프링의 컨테이너는 AnnotationConfigApplicationContext 를 사용해야 하며
												그중 웹애플리케이션에 특화된  를 써야한다. 										
		 -->
		<init-param>
			<param-name>contextClass</param-name>
			<param-value>org.springframework.web.context.support.AnnotationConfigWebApplicationContext</param-value>
		</init-param>
				 
		<init-param>
			<param-name>contextConfigLocation</param-name>
			<param-value>com.ch.shop.config.spring.AdminWebConfig</param-value>
		</init-param>
	</servlet>
	
	<servlet-mapping>
		<servlet-name>admin-dispatcher</servlet-name>
		<url-pattern>/admin/*</url-pattern>
	</servlet-mapping>
	
	
	
	<!-- 관리자가 아닌 일반 사용자들의 요청을 처리할 DispatcherServlet 매핑  -->
	<servlet>
		<servlet-name>shop-dispatcher</servlet-name>
		<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
		<init-param>
			<param-name>contextClass</param-name>
			<param-value>org.springframework.web.context.support.AnnotationConfigWebApplicationContext</param-value>
		</init-param>
		<init-param>
			<param-name>contextConfigLocation</param-name>
			<param-value>com.ch.shop.config.spring.ShopWebConfig</param-value>
		</init-param>
	</servlet>
	<servlet-mapping>
		<servlet-name>shop-dispatcher</servlet-name>
		<url-pattern>/</url-pattern>
	</servlet-mapping>	
	
</web-app>